(this["webpackJsonpbag-of-holding"]=this["webpackJsonpbag-of-holding"]||[]).push([[0],{615:function(e,t){},617:function(e,t){},630:function(e,t){},632:function(e,t){},660:function(e,t){},662:function(e,t){},663:function(e,t){},668:function(e,t){},670:function(e,t){},689:function(e,t){},701:function(e,t){},704:function(e,t){},721:function(e,t,n){"use strict";n.r(t);var c=n(7),a=n(27),i=n(0),r=n.n(i),o=n(18),s=n.n(o),u=n(83),d=n(483),j=n(248),l=n(742),b=n(747),f=n(746),O=n(756),h=n(754),m=n(116),x=Object(i.createContext)(null),v=n(77),p=n(752),g=n(757),I=n(90),C=n.n(I),S=n(481),w=n.n(S).a.create({baseURL:"https://handy-haversack.herokuapp.com/api/",headers:{authorization:"bearer "+window.localStorage.getItem("authToken")}});function y(){var e=Object(i.useState)([]),t=Object(a.a)(e,2),n=t[0],r=t[1],o=Object(i.useState)(!1),s=Object(a.a)(o,2),u=s[0],d=s[1],j=Object(i.useState)([]),l=Object(a.a)(j,2),b=l[0],f=l[1];Object(i.useEffect)((function(){w.get("/characters/").then((function(e){r(e.data.data)})).catch((function(e){f(["Cannot load character data"]),d(!0)}))}),[]);return Object(c.jsx)("div",{className:"App",children:Object(c.jsxs)(p.a,{container:!0,spacing:1,children:[Object(c.jsx)(p.a,{item:!0,xs:2}),Object(c.jsxs)(p.a,{item:!0,xs:12,sm:8,children:[Object(c.jsx)("div",{children:u&&Object(c.jsx)(g.a,{severity:"error",children:b.map((function(e,t){return Object(c.jsx)("div",{children:e},t)}))})}),Object(c.jsx)(C.a,{title:"Your Characters",columns:[{title:"id",field:"id",hidden:!0},{title:"Character name",field:"name"}],data:n,editable:{onRowAdd:function(e){return new Promise((function(t){!function(e,t){var c=[];void 0===e.name&&c.push("Please enter character name"),c.length<1?w.post("/characters/",e).then((function(t){var c=Object(v.a)(n);e.id=t.data.data.id,c.push(e),r(c),f([]),d(!1)})).catch((function(e){f(["Cannot add data. Server error!"]),d(!0)})):(f(c),d(!0))}(e),t()}))},onRowDelete:function(e){return new Promise((function(t){!function(e,t){w.delete("/characters/"+e.id).then((function(t){var c=Object(v.a)(n),a=e.tableData.id;c.splice(a,1),r(Object(v.a)(c))})).catch((function(e){f(["Delete failed! Server error"]),d(!0)}))}(e),t()}))}},options:{actionsColumnIndex:-1,search:!1}})]}),Object(c.jsx)(p.a,{item:!0,xs:3})]})})}var k=n(743),P=n(371),_=n(213),T=n(358),D=n(293),L=n.n(D),N=n(482),E=n(294),R=n(611);var A=function(){var e=Object(i.useContext)(x).setLoggedIn;Object(i.useEffect)((function(){var t=!0,n=localStorage.getItem("authToken");if(null===n)return t&&e(!1),function(){return t=!1};var c=R.decode(n,{complete:!0}),a=new Date;return c.exp<a.getTime()&&t&&e(!0),function(){return t=!1}}),[e]);var t=function(e){console.log(e)},n=function(t){window.localStorage.setItem("authToken",t.tokenObj.id_token),function(e){var t=1e3*(e.tokenObj.expires_in||3300),n=function(){var c=Object(N.a)(L.a.mark((function c(){var a;return L.a.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,e.reloadAuthResponse();case 2:a=c.sent,t=1e3*(a.expires_in||3300),localStorage.setItem("authToken",a.id_token),setTimeout(n,t);case 6:case"end":return c.stop()}}),c)})));return function(){return c.apply(this,arguments)}}();setTimeout(n,t)}(t),e(!0)},a=function(t){window.localStorage.removeItem("authToken"),e(!1)};return Object(c.jsx)(x.Consumer,{children:function(e){var i=e.loggedIn;return Object(c.jsx)("div",{children:i?Object(c.jsx)(E.GoogleLogout,{clientId:"1090301103642-op1uhu99i3naegpk86siaqqf4nddn0c1.apps.googleusercontent.com",buttonText:"Logout",onLogoutSuccess:a,onFailure:t,theme:"dark"}):Object(c.jsx)(E.GoogleLogin,{clientId:"1090301103642-op1uhu99i3naegpk86siaqqf4nddn0c1.apps.googleusercontent.com",buttonText:"Login",onSuccess:n,onFailure:t,cookiePolicy:"single_host_origin",isSignedIn:!0,theme:"dark"})})}})},F=Object(T.a)((function(e){return{root:{flexGrow:1},title:{flexGrow:1}}}));function q(){var e=F();return Object(c.jsx)("div",{className:e.root,children:Object(c.jsx)(k.a,{position:"static",children:Object(c.jsxs)(P.a,{children:[Object(c.jsx)(_.a,{variant:"h6",className:e.title,children:"Bag of Holding"}),Object(c.jsx)(A,{})]})})})}var G=n(744),B=n(745),U=n(373),J=n(758),z=Object(T.a)((function(e){return{mergecard:{flexDirection:"column",height:"100%"},gold:{paddingTop:"10px"}}}));function H(e){var t=z(),n=e.costTotal,r=e.onChange,o=Object(i.useState)([]),s=Object(a.a)(o,2),d=s[0],j=s[1],l=Object(i.useState)({}),b=Object(a.a)(l,2),f=b[0],O=b[1];return Object(i.useEffect)((function(){r(f)}),[f,r]),Object(i.useEffect)((function(){w.get("/characters/").then((function(e){j(e.data.data),O(e.data.data[0])})).catch((function(e){console.log("Cannot load character names")}))}),[]),Object(c.jsx)(G.a,{className:t.mergecard,children:Object(c.jsxs)(B.a,{children:[Object(c.jsx)(J.a,{id:"character-selection",value:f,options:d,getOptionLabel:function(e){return e.name},onChange:function(e,t){O(t)},renderInput:function(e){return Object(c.jsx)(U.a,Object(u.a)(Object(u.a)({},e),{},{label:"Character",variant:"outlined"}))}}),Object(c.jsxs)(_.a,{variant:"h5",className:t.gold,children:["Inventory Cost: ",n," gp"]})]})})}var M=[{title:"id",field:"id",hidden:!0},{title:"user_id",field:"user_id",hidden:!0},{title:"item_id",field:"user_id",hidden:!0},{title:"Item Name",field:"Item.name"},{title:"Cost",field:"Item.cost",type:"numeric"},{title:"Count",field:"count",type:"numeric"}];function Y(e){var t=M;return Object(c.jsx)(C.a,{title:"Items Consumed",columns:t,data:e.consumed,options:{actionsColumnIndex:-1}})}var K=n(359),Q=Object(T.a)((function(e){return{root:{height:"100%"}}}));function V(e){var t=Q(),n=Object(i.useState)([]),r=Object(a.a)(n,2),o=r[0],s=r[1],d=Object(i.useState)({}),j=Object(a.a)(d,2),l=j[0],b=j[1];return Object(i.useEffect)((function(){w.get("/names/").then((function(e){s(e.data.items)})).catch((function(e){console.log("Cannot load item names")}))}),[]),Object(c.jsx)(G.a,{className:t.root,children:Object(c.jsx)(B.a,{children:Object(c.jsxs)(p.a,{container:!0,spacing:2,children:[Object(c.jsx)(p.a,{item:!0,xs:12,sm:12,md:7,children:Object(c.jsx)(J.a,{id:"purchase-selection",options:o,getOptionLabel:function(e){return e.Name},onChange:function(e,t){b(t)},renderInput:function(e){return Object(c.jsx)(U.a,Object(u.a)(Object(u.a)({},e),{},{label:"Item to purchase",variant:"outlined"}))}})}),Object(c.jsx)(p.a,{item:!0,xs:12,sm:12,md:5,children:Object(c.jsx)(K.a,{variant:"contained",onClick:function(){e.buyItem(l)},children:"Purchase"})})]})})})}function W(e){var t=M,n=e.owned,a=e.removeItem,i=function(e,t){a(e,t)};return Object(c.jsx)(C.a,{title:"Items Owned",columns:t,data:n,editable:{onRowDelete:function(e){return new Promise((function(t){i(e,!1),t()}))}},actions:[{icon:"emoji_food_beverage",tooltip:"Consume Item",onClick:function(e,t){return new Promise((function(e){i(t,!0),e()}))}}],options:{actionsColumnIndex:-1}})}function X(){var e=Object(i.useState)([]),t=Object(a.a)(e,2),n=t[0],r=t[1],o=Object(i.useState)([]),s=Object(a.a)(o,2),u=s[0],d=s[1],j=Object(i.useState)({}),l=Object(a.a)(j,2),b=l[0],f=l[1],O=Object(i.useState)([]),h=Object(a.a)(O,2),m=h[0],x=h[1],v=Object(i.useState)(!1),I=Object(a.a)(v,2),C=I[0],S=I[1],y=Object(i.useState)([]),k=Object(a.a)(y,2),P=k[0],_=k[1],T=function(){return 0!==Object.keys(b).length||b.constructor!==Object||(_(["Please Select a Character"]),S(!0),!1)};return Object(i.useEffect)((function(){var e=!0;if(!e||T())return w.get("/inventory/"+b.id).then((function(t){e&&(r(t.data.owned),d(t.data.consumed),S(!1))})).catch((function(t){e&&(_(["Cannot load inventory data"]),S(!0))})),function(){return e=!1}}),[b]),Object(i.useEffect)((function(){var e=!0;return e&&(S(!1),_([])),function(){return e=!1}}),[]),Object(i.useEffect)((function(){var e=!0,t=[n.reduce((function(e,t){return e+(t.Item.cost*t.count||0)}),0)],c=[u.reduce((function(e,t){return e+(t.Item.cost*t.count||0)}),0)];return e&&x(Number(t)+Number(c)/2),function(){return e=!1}}),[n,u]),Object(c.jsx)("div",{className:"App",children:Object(c.jsxs)(p.a,{container:!0,spacing:1,children:[Object(c.jsx)(p.a,{item:!0,sm:12,md:2}),Object(c.jsx)(p.a,{item:!0,xs:12,sm:6,md:4,children:Object(c.jsx)(H,{onChange:f,costTotal:m})}),Object(c.jsx)(p.a,{item:!0,xs:12,sm:6,md:4,children:Object(c.jsx)(V,{buyItem:function(e){if(0===Object.keys(e).length&&e.constructor===Object)return _(["Please Select an Item"]),void S(!0);if(T()){var t={character_id:b.id,item_id:e.ID};w.post("/buy/",t).then((function(e){r(e.data.owned),d(e.data.consumed),S(!1)})).catch((function(e){_(["Cannot purchase Item"]),S(!0)}))}}})}),Object(c.jsx)(p.a,{item:!0,sm:1}),Object(c.jsx)(p.a,{item:!0,sm:1,md:2}),Object(c.jsxs)(p.a,{item:!0,sm:12,md:8,children:[Object(c.jsx)("div",{children:C&&Object(c.jsx)(g.a,{severity:"error",children:P.map((function(e,t){return Object(c.jsx)("div",{children:e},t)}))})}),Object(c.jsx)(W,{owned:n,removeItem:function(e,t){console.log(n,u);var c={character_id:e.character_id,item_id:e.item_id},a="/sell/";!0===t&&(a="/consume/"),w.post(a,c).then((function(e){r(e.data.owned),d(e.data.consumed)})).catch((function(e){_(["Delete failed! Server error",e.error]),S(!0)}))}})]}),Object(c.jsx)(p.a,{item:!0,xs:1}),Object(c.jsx)(p.a,{item:!0,sm:1,md:2}),Object(c.jsx)(p.a,{item:!0,sm:12,md:8,children:Object(c.jsx)(Y,{consumed:u})})]})})}function Z(){var e=Object(i.useState)([]),t=Object(a.a)(e,2),n=t[0],r=t[1],o=Object(i.useState)(!1),s=Object(a.a)(o,2),u=s[0],d=s[1],j=Object(i.useState)([]),l=Object(a.a)(j,2),b=l[0],f=l[1];Object(i.useEffect)((function(){w.get("/items").then((function(e){r(e.data.data)})).catch((function(e){f(["Cannot load item data",e.error]),d(!0)}))}),[]);var O=[{title:"id",field:"id",hidden:!0},{title:"Item name",field:"name"},{title:"Type",field:"type"},{title:"Rarity",field:"rarity"},{title:"Cost",field:"cost",type:"numeric"}];return Object(c.jsx)(x.Consumer,{children:function(e){var t=e.loggedIn;return Object(c.jsx)("div",{className:"App",children:Object(c.jsxs)(p.a,{container:!0,spacing:1,children:[Object(c.jsx)(p.a,{item:!0,xs:2}),Object(c.jsxs)(p.a,{item:!0,xs:12,sm:8,children:[Object(c.jsx)("div",{children:u&&Object(c.jsx)(g.a,{severity:"error",children:b.map((function(e,t){return Object(c.jsx)("div",{children:e},t)}))})}),Object(c.jsx)(C.a,{title:"Defined Items",columns:O,data:n,editable:{onRowUpdate:t?function(e,t){return new Promise((function(c){!function(e,t,c){var a=[];void 0===e.name&&a.push("Please enter item name"),void 0===e.type&&a.push("Please enter item type"),void 0===e.rarity&&a.push("Please enter rarity"),(void 0===e.cost||e.cost<0)&&a.push("Please enter a proper cost"),a.length<1?w.patch("/items/"+e.id,e).then((function(c){var a=Object(v.a)(n);a[t.tableData.id]=e,r(Object(v.a)(a)),d(!1),f([])})).catch((function(e){f(["Update failed! Server error"]),d(!0)})):(f(a),d(!0))}(e,t),c()}))}:null,onRowAdd:t?function(e){return new Promise((function(t){!function(e,t){var c=[];void 0===e.name&&c.push("Please enter item name"),void 0===e.type&&c.push("Please enter item type"),void 0===e.rarity&&c.push("Please enter rarity"),(void 0===e.cost||e.cost<0)&&c.push("Please enter a proper cost"),c.length<1?w.post("/items",e).then((function(t){var c=Object(v.a)(n);e.id=t.data.data.id,c.push(e),r(c),f([]),d(!1)})).catch((function(e){f(["Cannot add data. Server error!"]),d(!0)})):(f(c),d(!0))}(e),t()}))}:null,onRowDelete:t?function(e){return new Promise((function(t){!function(e,t){w.delete("/items/"+e.id).then((function(t){var c=Object(v.a)(n),a=e.tableData.id;c.splice(a,1),r(Object(v.a)(c))})).catch((function(e){f(["Delete failed! Server error"]),d(!0)}))}(e),t()}))}:null},options:{actionsColumnIndex:-1}})]}),Object(c.jsx)(p.a,{item:!0,xs:3})]})})}})}var $=Object(m.a)({palette:{type:"dark"}});function ee(){var e=Object(i.useState)(0),t=Object(a.a)(e,2),n=t[0],r=t[1],o=function(e,t){r(t)};function s(e){var t=e.children,n=e.value,a=e.index,i=Object(d.a)(e,["children","value","index"]);return Object(c.jsx)("div",Object(u.a)(Object(u.a)({},i),{},{children:n===a&&Object(c.jsx)(j.a,{p:3,children:t})}))}return Object(c.jsxs)(l.a,{theme:$,children:[Object(c.jsx)(b.a,{}),Object(c.jsx)(q,{}),Object(c.jsx)(f.a,{children:Object(c.jsx)(x.Consumer,{children:function(e){var t=e.loggedIn;return Object(c.jsxs)(O.a,{value:n,onChange:o,children:[Object(c.jsx)(h.a,{label:"Items"}),Object(c.jsx)(h.a,{label:"Inventory",disabled:!t}),Object(c.jsx)(h.a,{label:"Characters",disabled:!t})]})}})}),Object(c.jsx)(s,{value:n,index:0,children:Object(c.jsx)(Z,{})}),Object(c.jsx)(s,{value:n,index:1,children:Object(c.jsx)(X,{})}),Object(c.jsx)(s,{value:n,index:2,children:Object(c.jsx)(y,{})})]})}$.shadows=[];var te=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,760)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,i=t.getLCP,r=t.getTTFB;n(e),c(e),a(e),i(e),r(e)}))},ne=function(){var e=Object(i.useState)(!1),t=Object(a.a)(e,2),n=t[0],o=t[1];return Object(c.jsx)(x.Provider,{value:{loggedIn:n,setLoggedIn:o},children:Object(c.jsx)(r.a.StrictMode,{children:Object(c.jsx)(ee,{})})})};s.a.render(Object(c.jsx)(ne,{}),document.getElementById("root")),te()}},[[721,1,2]]]);
//# sourceMappingURL=main.d9de7eb0.chunk.js.map