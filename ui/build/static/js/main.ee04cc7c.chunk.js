(this["webpackJsonpbag-of-holding"]=this["webpackJsonpbag-of-holding"]||[]).push([[0],{502:function(e,t,n){"use strict";n.r(t);var a=n(25),c=n(0),r=n.n(c),o=n(16),i=n.n(o),s=n(523),d=n(525),u=n(99),l=Object(c.createContext)(null),j=n(110),b=n(530),h=n(535),m=n(67),f=n.n(m),O=n(231),x=n.n(O).a.create({baseURL:"https://handy-haversack.herokuapp.com/api/",headers:{Authorization:"Bearer "+window.localStorage.getItem("authToken")}}),v=n(6);function p(){var e=Object(c.useState)([]),t=Object(a.a)(e,2),n=t[0],r=t[1],o=Object(c.useState)(!1),i=Object(a.a)(o,2),s=i[0],d=i[1],u=Object(c.useState)([]),l=Object(a.a)(u,2),m=l[0],O=l[1];Object(c.useEffect)((function(){x.get("/characters/").then((function(e){r(e.data.characters)})).catch((function(e){O(["Cannot load character data"]),d(!0)}))}),[]);return Object(v.jsx)("div",{className:"App",children:Object(v.jsxs)(b.a,{container:!0,spacing:1,children:[Object(v.jsx)(b.a,{item:!0,xs:2}),Object(v.jsxs)(b.a,{item:!0,xs:12,sm:8,children:[Object(v.jsx)("div",{children:s&&Object(v.jsx)(h.a,{severity:"error",children:m.map((function(e,t){return Object(v.jsx)("div",{children:e},t)}))})}),Object(v.jsx)(f.a,{title:"Your Characters",columns:[{title:"id",field:"id",hidden:!0},{title:"Character name",field:"name"}],data:n,editable:{onRowAdd:function(e){return new Promise((function(t){!function(e,t){if(void 0===e.name)return O(["Please enter character name"]),void d(!0);x.post("/characters/",e).then((function(e){r(n.concat(e.data.character)),d(!1)})).catch((function(e){O(["Cannot add data. Server error!"+e]),d(!0)}))}(e),t()}))},onRowDelete:function(e){return new Promise((function(t){!function(e,t){x.delete("/characters/"+e.id).then((function(t){var a=Object(j.a)(n),c=e.tableData.id;a.splice(c,1),r(Object(j.a)(a)),O([])})).catch((function(e){O(["Delete failed! Server error"]),d(!0)}))}(e),t()}))}},options:{actionsColumnIndex:-1,paging:!1,search:!1}})]}),Object(v.jsx)(b.a,{item:!0,xs:3})]})})}var g=n(524),y=n(320),C=n(184),w=n(306),I=n(373),S=n.n(I),k=n(307),P=n(241);function D(){var e=Object(c.useContext)(l).setLoggedIn;Object(c.useEffect)((function(){var t=!0;return null===localStorage.getItem("authToken")?t&&e(!1):t&&e(!0),function(){return t=!1}}),[e]);S()(x,(function(e){return x.get("/refresh").then((function(t){return localStorage.setItem("authToken",t.data.token),x.defaults.headers.Authorization="Bearer "+t.data.token,e.response.config.headers.Authorization="Bearer "+t.data.token,Promise.resolve()}))}));var t=function(e){console.log(e)},n=function(t){x.post("/login",{token:t.tokenObj.id_token}).then((function(t){window.localStorage.setItem("authToken",t.data.token),x.defaults.headers.Authorization="Bearer "+t.data.token,e(!0)})).catch((function(e){console.log("Authentication failed")}))},a=function(t){window.localStorage.removeItem("authToken"),e(!1)};return Object(v.jsx)(l.Consumer,{children:function(e){var c=e.loggedIn;return Object(v.jsx)("div",{children:c?Object(v.jsx)(P.GoogleLogout,{clientId:"1090301103642-op1uhu99i3naegpk86siaqqf4nddn0c1.apps.googleusercontent.com",buttonText:"Logout",onLogoutSuccess:a,onFailure:t,render:function(e){return Object(v.jsx)(k.a,{variant:"contained",onClick:e.onClick,disabled:e.disabled,children:"Logout"})},theme:"dark"}):Object(v.jsx)(P.GoogleLogin,{clientId:"1090301103642-op1uhu99i3naegpk86siaqqf4nddn0c1.apps.googleusercontent.com",buttonText:"Login",onSuccess:n,onFailure:t,cookiePolicy:"single_host_origin",isSignedIn:!0,theme:"dark"})})}})}var T=Object(w.a)((function(e){return{root:{flexGrow:1},title:{flexGrow:1}}}));function _(){var e=T();return Object(v.jsx)("div",{className:e.root,children:Object(v.jsx)(g.a,{position:"static",children:Object(v.jsxs)(y.a,{children:[Object(v.jsx)(C.a,{variant:"h6",className:e.title,children:"Handy Haversack"}),Object(v.jsx)(D,{})]})})})}var N=n(349),L=n(50),B=n(322),A=n(536),E=Object(w.a)((function(e){return{mergecard:{flexDirection:"column",height:"100%"},costText:{paddingTop:"10px"}}}));function R(e){var t=E(),n=e.costTotal,r=e.onChange,o=Object(c.useState)([]),i=Object(a.a)(o,2),s=i[0],d=i[1],u=Object(c.useState)({}),l=Object(a.a)(u,2),j=l[0],b=l[1];return Object(c.useEffect)((function(){r(j)}),[j,r]),Object(c.useEffect)((function(){x.get("/characters/").then((function(e){d(e.data.characters),e.data.characters.length>0&&b(e.data.characters[0])})).catch((function(e){console.log("Cannot load character names")}))}),[]),Object(v.jsxs)("div",{className:t.mergecard,children:[Object(v.jsx)(A.a,{id:"character-selection",value:j,options:s,getOptionLabel:function(e){return e.name},onChange:function(e,t){b(t)},renderInput:function(e){return Object(v.jsx)(B.a,Object(L.a)(Object(L.a)({},e),{},{label:"Character",variant:"outlined"}))}}),Object(v.jsxs)(C.a,{variant:"h6",className:t.costText,children:["Inventory Cost: ",n," gp"]})]})}function z(e){var t=e.consumed,n=e.removeItem,a=e.columns;return Object(v.jsx)(f.a,{title:"Consumed Items",columns:a,data:t,actions:[{icon:"restore",tooltip:"Undo consume",onClick:function(e,t){return new Promise((function(e){!function(e,t){n(e,t)}(t,!0),e()}))}}],options:{actionsColumnIndex:-1,paging:!1,rowStyle:function(e,t){if(t%2)return{backgroundColor:"#333333"}},search:!1}})}var F=Object(w.a)((function(e){return{outerCard:{flexDirection:"column",height:"100%"},itemDropdown:{paddingBottom:"10px"}}}));function q(e){var t=F(),n=Object(c.useState)([]),r=Object(a.a)(n,2),o=r[0],i=r[1],s=Object(c.useState)({}),d=Object(a.a)(s,2),u=d[0],l=d[1];return Object(c.useEffect)((function(){x.get("/names/").then((function(e){i(e.data.items)})).catch((function(e){console.log("Cannot load item names")}))}),[]),Object(v.jsxs)("div",{className:t.outerCard,children:[Object(v.jsx)(A.a,{className:t.itemDropdown,options:o,getOptionLabel:function(e){return e.Name},onChange:function(e,t){l(t)},renderInput:function(e){return Object(v.jsx)(B.a,Object(L.a)(Object(L.a)({},e),{},{label:"Item to buy",variant:"outlined"}))}}),Object(v.jsx)(k.a,{variant:"contained",onClick:function(){e.buyItem(u)},children:"Buy Item"})]})}var G=n(18);function U(e){var t=e.owned,n=e.removeItem,a=e.columns,c=Object(G.a)(),r=function(e,t){n(e,t)};return Object(v.jsx)(f.a,{title:"Owned Items",columns:a,data:t,editable:{onRowDelete:function(e){return new Promise((function(t){r(e,!1),t()}))}},actions:[{icon:"emoji_food_beverage",tooltip:"Consume",onClick:function(e,t){return new Promise((function(e){r(t,!0),e()}))}}],options:{actionsColumnIndex:-1,paging:!1,rowStyle:function(e,t){if((t+1)%2)return{backgroundColor:c.palette.action.hover}},search:!1}})}var V=n(511);function H(){var e=Object(c.useState)([]),t=Object(a.a)(e,2),n=t[0],r=t[1],o=Object(c.useState)([]),i=Object(a.a)(o,2),s=i[0],d=i[1],u=Object(c.useState)({}),l=Object(a.a)(u,2),j=l[0],m=l[1],f=Object(c.useState)(0),O=Object(a.a)(f,2),p=O[0],g=O[1],y=Object(c.useState)(!1),C=Object(a.a)(y,2),w=C[0],I=C[1],S=Object(c.useState)([]),k=Object(a.a)(S,2),P=k[0],D=k[1],T=function(){return console.log("Character: ",j),null!==j&&(j.constructor!==Object||0!==Object.keys(j).length)||(D(["Please select a character. If you have no characters, add one in the Characters tab"]),I(!0),!1)};Object(c.useEffect)((function(){var e=!0;if(!e||T())return x.get("/inventory/"+j.id).then((function(t){e&&(r(t.data.owned),d(t.data.consumed),g(t.data.cost),I(!1))})).catch((function(t){e&&(D(["Cannot load inventory data"]),I(!0))})),function(){return e=!1}}),[j]);var _=Object(G.a)(),L=[{title:"id",field:"id",hidden:!0},{title:"user_id",field:"user_id",hidden:!0},{title:"item_id",field:"user_id",hidden:!0},{title:"Name",field:"Item.name"},{title:"Rarity",field:"Item.rarity",hidden:Object(V.a)(_.breakpoints.down("xs"))},{title:"Cost",field:"Item.cost",type:"numeric",cellStyle:{padding:1},headerStyle:{padding:1}},{title:"Qty",field:"count",type:"numeric"}];return Object(v.jsx)("div",{className:"App",children:Object(v.jsxs)(b.a,{container:!0,spacing:1,children:[Object(v.jsx)(N.a,{smDown:!0,children:Object(v.jsx)(b.a,{item:!0,md:2})}),Object(v.jsx)(b.a,{item:!0,xs:12,sm:6,md:4,children:Object(v.jsx)(R,{onChange:m,costTotal:p})}),Object(v.jsx)(b.a,{item:!0,xs:12,sm:6,md:4,children:Object(v.jsx)(q,{buyItem:function(e){if(0===Object.keys(e).length&&e.constructor===Object)return D(["Please Select an Item"]),void I(!0);if(T()){var t={character_id:j.id,item_id:e.ID};x.post("/buy/",t).then((function(e){r(e.data.owned),d(e.data.consumed),g(e.data.cost),I(!1)})).catch((function(e){D(["Cannot Buy Item"]),I(!0)}))}}})}),Object(v.jsxs)(N.a,{smDown:!0,children:[Object(v.jsx)(b.a,{item:!0,md:1}),Object(v.jsx)(b.a,{item:!0,md:2})]}),Object(v.jsxs)(b.a,{item:!0,xs:12,md:8,children:[Object(v.jsx)("div",{children:w&&Object(v.jsx)(h.a,{severity:"error",children:P.map((function(e,t){return Object(v.jsx)("div",{children:e},t)}))})}),Object(v.jsx)(U,{owned:n,removeItem:function(e,t){var n={character_id:e.character_id,item_id:e.item_id};x.post(t?"/consume/":"/sell/",n).then((function(e){r(e.data.owned),d(e.data.consumed),g(e.data.cost),I(!1)})).catch((function(e){D(["Delete failed! Server error",e.error]),I(!0)}))},columns:L})]}),Object(v.jsxs)(N.a,{smDown:!0,children:[Object(v.jsx)(b.a,{item:!0,md:1}),Object(v.jsx)(b.a,{item:!0,md:2})]}),Object(v.jsx)(b.a,{item:!0,xs:12,md:8,children:Object(v.jsx)(z,{consumed:s,removeItem:function(e,t){var n={character_id:e.character_id,item_id:e.item_id};x.post("/unconsume/",n).then((function(e){r(e.data.owned),d(e.data.consumed),g(e.data.cost),I(!1)})).catch((function(e){D(["Delete failed! Server error",e.error]),I(!0)}))},columns:L})})]})})}var J=Object(w.a)((function(e){return{title:{paddingLeft:"20px",paddingTop:"10px"}}}));function M(e){var t=J();return Object(v.jsx)("div",{children:Object(v.jsxs)(b.a,{container:!0,spacing:1,children:[Object(v.jsx)(b.a,{item:!0,xs:12,sm:6,children:Object(v.jsx)(C.a,{variant:"h6",className:t.title,children:"Campaign Items"})}),Object(v.jsx)(b.a,{item:!0,xs:12,sm:6,children:Object(v.jsx)(m.MTableToolbar,Object(L.a)({},e))})]})})}function Q(){var e=Object(c.useState)([]),t=Object(a.a)(e,2),n=t[0],r=t[1],o=Object(c.useState)(!1),i=Object(a.a)(o,2),s=i[0],d=i[1],u=Object(c.useState)([]),m=Object(a.a)(u,2),O=m[0],p=m[1];Object(c.useEffect)((function(){x.get("/items").then((function(e){r(e.data.items)})).catch((function(e){p(["Cannot load item data",e.error]),d(!0)}))}),[]);var g=[{title:"id",field:"id",hidden:!0},{title:"Name",field:"name",render:function(e){return Object(v.jsxs)("div",{children:[e.name," ",Object(v.jsx)("br",{}),Object(v.jsx)(C.a,{variant:"caption",display:"block",gutterBottom:!0,children:e.type})]})},validate:function(e){return""===e.name?"Type cannot be empty":""},editComponent:function(e){return Object(v.jsxs)("div",{children:[Object(v.jsx)(B.a,{label:"Name",size:"xsmall",defaultValue:e.value,placeholder:"Name",onChange:function(t){return e.onChange(t.target.value)}}),Object(v.jsx)(B.a,{label:"Type",size:"small",defaultValue:e.rowData.type,placeholder:"Type",onChange:function(t){return e.rowData.type=t.target.value}})]})}},{title:"Type",field:"type",hidden:!0},{title:"Rarity",field:"rarity"},{title:"Cost",field:"cost",type:"numeric"}];return Object(v.jsxs)(b.a,{container:!0,spacing:1,children:[Object(v.jsx)(N.a,{smDown:!0,children:Object(v.jsx)(b.a,{item:!0,md:2})}),Object(v.jsxs)(b.a,{item:!0,xs:12,md:8,children:[Object(v.jsx)("div",{children:s&&Object(v.jsx)(h.a,{severity:"error",children:O.map((function(e,t){return Object(v.jsx)("div",{children:e},t)}))})}),Object(v.jsx)(l.Consumer,{children:function(e){var t=e.loggedIn;return Object(v.jsx)(f.a,{title:"Defined Items",columns:g,data:n,editable:{onRowUpdate:t?function(e,t){return new Promise((function(a){!function(e,t,a){var c=[];void 0!==e.name&&""!==e.name||c.push("Please enter item name"),void 0!==e.type&&""!==e.type||c.push("Please enter item type"),void 0!==e.rarity&&""!==e.rarity||c.push("Please enter rarity"),(void 0===e.cost||e.cost<0||isNaN(e.cost))&&c.push("Please enter a proper cost"),console.log(e.cost),c.length<1?x.patch("/items/"+e.id,e).then((function(a){var c=Object(j.a)(n);c[t.tableData.id]=e,r(Object(j.a)(c)),d(!1),p([])})).catch((function(e){p(["Update failed! Server error"]),d(!0)})):(p(c),d(!0))}(e,t),a()}))}:null,onRowAdd:t?function(e){return new Promise((function(t){!function(e,t){var a=[];void 0===e.name&&a.push("Please enter item name"),void 0===e.type&&a.push("Please enter item type"),void 0===e.rarity&&a.push("Please enter rarity"),(void 0===e.cost||e.cost<0)&&a.push("Please enter a proper cost"),a.length<1?x.post("/items",e).then((function(e){r(n.concat(e.data.data)),d(!1)})).catch((function(e){p(["Cannot add data. Server error!"]),d(!0)})):(p(a),d(!0))}(e),t()}))}:null,onRowDelete:t?function(e){return new Promise((function(t){!function(e,t){x.delete("/items/"+e.id).then((function(t){r(n.filter((function(t){return t.id!==e.id})))})).catch((function(e){p(["Delete failed! Server error"]),d(!0)}))}(e),t()}))}:null},options:{actionsColumnIndex:-1,header:!0,pageSize:10,pageSizeOptions:[10,25,50],showTitle:!1},components:{Toolbar:function(e){return Object(v.jsx)(M,Object(L.a)({},e))}}})}})]}),Object(v.jsx)(N.a,{smDown:!0,children:Object(v.jsx)(b.a,{item:!0,md:8})})]})}var Y=n(243),K=n(534),W=n(532);function X(e){var t=e.value,n=e.setValue,a=function(e,t){n(t)};return Object(v.jsx)(Y.a,{square:!0,children:Object(v.jsx)(l.Consumer,{children:function(e){var n=e.loggedIn;return Object(v.jsxs)(K.a,{value:t,onChange:a,centered:!0,children:[Object(v.jsx)(W.a,{label:"Items"}),Object(v.jsx)(W.a,{label:"Inventory",disabled:!n}),Object(v.jsx)(W.a,{label:"Characters",disabled:!n})]})}})})}var Z=n(374),$=n(217);function ee(e){var t=e.children,n=e.value,a=e.index,c=Object(Z.a)(e,["children","value","index"]);return Object(v.jsx)("div",Object(L.a)(Object(L.a)({},c),{},{children:n===a&&Object(v.jsx)($.a,{p:3,children:t})}))}var te=Object(u.a)({palette:{type:"dark"}});function ne(){var e=Object(c.useState)(0),t=Object(a.a)(e,2),n=t[0],r=t[1],o=Object(c.useContext)(l).loggedIn;return Object(c.useEffect)((function(){o||r(0)}),[o]),Object(v.jsxs)(s.a,{theme:te,children:[Object(v.jsx)(d.a,{}),Object(v.jsx)(_,{}),Object(v.jsx)(X,{value:n,setValue:r}),Object(v.jsx)(ee,{value:n,index:0,children:Object(v.jsx)(Q,{})}),Object(v.jsx)(ee,{value:n,index:1,children:Object(v.jsx)(H,{})}),Object(v.jsx)(ee,{value:n,index:2,children:Object(v.jsx)(p,{})})]})}te.shadows=[];var ae=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,538)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,r=t.getLCP,o=t.getTTFB;n(e),a(e),c(e),r(e),o(e)}))},ce=function(){var e=Object(c.useState)(!1),t=Object(a.a)(e,2),n=t[0],o=t[1];return Object(v.jsx)(l.Provider,{value:{loggedIn:n,setLoggedIn:o},children:Object(v.jsx)(r.a.StrictMode,{children:Object(v.jsx)(ne,{})})})};i.a.render(Object(v.jsx)(ce,{}),document.getElementById("root")),ae()}},[[502,1,2]]]);
//# sourceMappingURL=main.ee04cc7c.chunk.js.map