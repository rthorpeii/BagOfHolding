(this["webpackJsonpbag-of-holding"]=this["webpackJsonpbag-of-holding"]||[]).push([[0],{614:function(e,t){},616:function(e,t){},629:function(e,t){},631:function(e,t){},659:function(e,t){},661:function(e,t){},662:function(e,t){},667:function(e,t){},669:function(e,t){},688:function(e,t){},700:function(e,t){},703:function(e,t){},720:function(e,t,n){"use strict";n.r(t);var c=n(27),a=n(0),i=n.n(a),o=n(18),r=n.n(o),s=n(83),u=n(483),d=n(249),l=n(741),j=n(746),b=n(745),f=n(755),h=n(753),m=n(117),O=Object(a.createContext)(null),x=n(77),v=n(751),p=n(756),g=n(90),I=n.n(g),C=n(285),S=n.n(C).a.create({baseURL:"https://handy-haversack.herokuapp.com/api/",headers:{Authorization:"Bearer "+window.localStorage.getItem("authToken")}}),w=n(7);function y(){var e=Object(a.useState)([]),t=Object(c.a)(e,2),n=t[0],i=t[1],o=Object(a.useState)(!1),r=Object(c.a)(o,2),s=r[0],u=r[1],d=Object(a.useState)([]),l=Object(c.a)(d,2),j=l[0],b=l[1];Object(a.useEffect)((function(){S.get("/characters/").then((function(e){i(e.data.data)})).catch((function(e){b(["Cannot load character data"]),u(!0)}))}),[]);return Object(w.jsx)("div",{className:"App",children:Object(w.jsxs)(v.a,{container:!0,spacing:1,children:[Object(w.jsx)(v.a,{item:!0,xs:2}),Object(w.jsxs)(v.a,{item:!0,xs:12,sm:8,children:[Object(w.jsx)("div",{children:s&&Object(w.jsx)(p.a,{severity:"error",children:j.map((function(e,t){return Object(w.jsx)("div",{children:e},t)}))})}),Object(w.jsx)(I.a,{title:"Your Characters",columns:[{title:"id",field:"id",hidden:!0},{title:"Character name",field:"name"}],data:n,editable:{onRowAdd:function(e){return new Promise((function(t){!function(e,t){var c=[];void 0===e.name&&c.push("Please enter character name"),c.length<1?S.post("/characters/",e).then((function(t){var c=Object(x.a)(n);e.id=t.data.data.id,c.push(e),i(c),b([]),u(!1)})).catch((function(e){b(["Cannot add data. Server error!"]),u(!0)})):(b(c),u(!0))}(e),t()}))},onRowDelete:function(e){return new Promise((function(t){!function(e,t){S.delete("/characters/"+e.id).then((function(t){var c=Object(x.a)(n),a=e.tableData.id;c.splice(a,1),i(Object(x.a)(c))})).catch((function(e){b(["Delete failed! Server error"]),u(!0)}))}(e),t()}))}},options:{actionsColumnIndex:-1,search:!1}})]}),Object(w.jsx)(v.a,{item:!0,xs:3})]})})}var k=n(742),P=n(372),_=n(214),D=n(359),T=n(482),L=n.n(T),N=n(295),A=n(610);var E=function(){var e=Object(a.useContext)(O).setLoggedIn;Object(a.useEffect)((function(){var t=!0,n=localStorage.getItem("authToken");if(null===n)return t&&e(!1),function(){return t=!1};var c=A.decode(n,{complete:!0}),a=new Date;return c.exp<a.getTime()&&t&&e(!0),function(){return t=!1}}),[e]),L()(S,(function(e){return S.get("/refresh").then((function(t){return localStorage.setItem("authToken",t.data.token),S.defaults.headers.Authorization="Bearer "+t.data.token,e.response.config.headers.Authorization="Bearer "+t.data.token,Promise.resolve()}))}));var t=function(e){console.log(e)},n=function(t){S.post("/login",{token:t.tokenObj.id_token}).then((function(t){window.localStorage.setItem("authToken",t.data.token),S.defaults.headers.Authorization="Bearer "+t.data.token,e(!0)})).catch((function(e){console.log("Authentication failed")}))},c=function(t){window.localStorage.removeItem("authToken"),e(!1)};return Object(w.jsx)(O.Consumer,{children:function(e){var a=e.loggedIn;return Object(w.jsx)("div",{children:a?Object(w.jsx)(N.GoogleLogout,{clientId:"1090301103642-op1uhu99i3naegpk86siaqqf4nddn0c1.apps.googleusercontent.com",buttonText:"Logout",onLogoutSuccess:c,onFailure:t,theme:"dark"}):Object(w.jsx)(N.GoogleLogin,{clientId:"1090301103642-op1uhu99i3naegpk86siaqqf4nddn0c1.apps.googleusercontent.com",buttonText:"Login",onSuccess:n,onFailure:t,cookiePolicy:"single_host_origin",isSignedIn:!0,theme:"dark"})})}})},R=Object(D.a)((function(e){return{root:{flexGrow:1},title:{flexGrow:1}}}));function B(){var e=R();return Object(w.jsx)("div",{className:e.root,children:Object(w.jsx)(k.a,{position:"static",children:Object(w.jsxs)(P.a,{children:[Object(w.jsx)(_.a,{variant:"h6",className:e.title,children:"Bag of Holding"}),Object(w.jsx)(E,{})]})})})}var F=n(743),q=n(744),z=n(374),G=n(757),U=Object(D.a)((function(e){return{mergecard:{flexDirection:"column",height:"100%"},gold:{paddingTop:"10px"}}}));function J(e){var t=U(),n=e.costTotal,i=e.onChange,o=Object(a.useState)([]),r=Object(c.a)(o,2),u=r[0],d=r[1],l=Object(a.useState)({}),j=Object(c.a)(l,2),b=j[0],f=j[1];return Object(a.useEffect)((function(){i(b)}),[b,i]),Object(a.useEffect)((function(){S.get("/characters/").then((function(e){d(e.data.data),f(e.data.data[0])})).catch((function(e){console.log("Cannot load character names")}))}),[]),Object(w.jsx)(F.a,{className:t.mergecard,children:Object(w.jsxs)(q.a,{children:[Object(w.jsx)(G.a,{id:"character-selection",value:b,options:u,getOptionLabel:function(e){return e.name},onChange:function(e,t){f(t)},renderInput:function(e){return Object(w.jsx)(z.a,Object(s.a)(Object(s.a)({},e),{},{label:"Character",variant:"outlined"}))}}),Object(w.jsxs)(_.a,{variant:"h6",className:t.gold,children:["Inventory Cost: ",n," gp"]})]})})}var H=[{title:"id",field:"id",hidden:!0},{title:"user_id",field:"user_id",hidden:!0},{title:"item_id",field:"user_id",hidden:!0},{title:"Item Name",field:"Item.name"},{title:"Rarity",field:"Item.rarity"},{title:"Cost",field:"Item.cost",type:"numeric"},{title:"Count",field:"count",type:"numeric"}];function M(e){var t=H,n=e.consumed,c=e.removeItem;return Object(w.jsx)(I.a,{title:"Items Consumed",columns:t,data:n,actions:[{icon:"restore",tooltip:"Undo consume",onClick:function(e,t){return new Promise((function(e){!function(e,t){c(e,t)}(t,!0),e()}))}}],options:{actionsColumnIndex:-1,rowStyle:function(e,t){if(t%2)return{backgroundColor:"#333333"}}}})}var Y=n(360),K=Object(D.a)((function(e){return{root:{height:"100%"}}}));function Q(e){var t=K(),n=Object(a.useState)([]),i=Object(c.a)(n,2),o=i[0],r=i[1],u=Object(a.useState)({}),d=Object(c.a)(u,2),l=d[0],j=d[1];return Object(a.useEffect)((function(){S.get("/names/").then((function(e){r(e.data.items)})).catch((function(e){console.log("Cannot load item names")}))}),[]),Object(w.jsx)(F.a,{className:t.root,children:Object(w.jsx)(q.a,{children:Object(w.jsxs)(v.a,{container:!0,spacing:2,children:[Object(w.jsx)(v.a,{item:!0,xs:12,sm:12,md:7,children:Object(w.jsx)(G.a,{id:"purchase-selection",options:o,getOptionLabel:function(e){return e.Name},onChange:function(e,t){j(t)},renderInput:function(e){return Object(w.jsx)(z.a,Object(s.a)(Object(s.a)({},e),{},{label:"Item to purchase",variant:"outlined"}))}})}),Object(w.jsx)(v.a,{item:!0,xs:12,sm:12,md:5,children:Object(w.jsx)(Y.a,{variant:"contained",onClick:function(){e.buyItem(l)},children:"Purchase"})})]})})})}function V(e){var t=H,n=e.owned,c=e.removeItem,a=function(e,t){c(e,t)};return Object(w.jsx)(I.a,{title:"Items Owned",columns:t,data:n,editable:{onRowDelete:function(e){return new Promise((function(t){a(e,!1),t()}))}},actions:[{icon:"emoji_food_beverage",tooltip:"Consume",onClick:function(e,t){return new Promise((function(e){a(t,!0),e()}))}}],options:{actionsColumnIndex:-1,rowStyle:function(e,t){if(t%2)return{backgroundColor:"#333333"}}}})}function W(){var e=Object(a.useState)([]),t=Object(c.a)(e,2),n=t[0],i=t[1],o=Object(a.useState)([]),r=Object(c.a)(o,2),s=r[0],u=r[1],d=Object(a.useState)({}),l=Object(c.a)(d,2),j=l[0],b=l[1],f=Object(a.useState)(0),h=Object(c.a)(f,2),m=h[0],O=h[1],x=Object(a.useState)(!1),g=Object(c.a)(x,2),I=g[0],C=g[1],y=Object(a.useState)([]),k=Object(c.a)(y,2),P=k[0],_=k[1],D=function(){return 0!==Object.keys(j).length||j.constructor!==Object||(_(["Please Select a Character"]),C(!0),!1)};return Object(a.useEffect)((function(){var e=!0;if(!e||D())return S.get("/inventory/"+j.id).then((function(t){e&&(i(t.data.owned),u(t.data.consumed),C(!1))})).catch((function(t){e&&(_(["Cannot load inventory data"]),C(!0))})),function(){return e=!1}}),[j]),Object(a.useEffect)((function(){var e=!0;return e&&(C(!1),_([])),function(){return e=!1}}),[]),Object(a.useEffect)((function(){console.log(n);var e=!0,t=[n.reduce((function(e,t){return e+(t.Item.cost*t.count||0)}),0)],c=[s.reduce((function(e,t){return e+(t.Item.cost*t.count||0)}),0)];return e&&O(Number(t)+Number(c)),function(){return e=!1}}),[n,s]),Object(w.jsx)("div",{className:"App",children:Object(w.jsxs)(v.a,{container:!0,spacing:1,children:[Object(w.jsx)(v.a,{item:!0,sm:12,md:2}),Object(w.jsx)(v.a,{item:!0,xs:12,sm:6,md:4,children:Object(w.jsx)(J,{onChange:b,costTotal:m})}),Object(w.jsx)(v.a,{item:!0,xs:12,sm:6,md:4,children:Object(w.jsx)(Q,{buyItem:function(e){if(0===Object.keys(e).length&&e.constructor===Object)return _(["Please Select an Item"]),void C(!0);if(D()){var t={character_id:j.id,item_id:e.ID};S.post("/buy/",t).then((function(e){i(e.data.owned),u(e.data.consumed),C(!1)})).catch((function(e){_(["Cannot purchase Item"]),C(!0)}))}}})}),Object(w.jsx)(v.a,{item:!0,sm:1}),Object(w.jsx)(v.a,{item:!0,sm:1,md:2}),Object(w.jsxs)(v.a,{item:!0,sm:12,md:8,children:[Object(w.jsx)("div",{children:I&&Object(w.jsx)(p.a,{severity:"error",children:P.map((function(e,t){return Object(w.jsx)("div",{children:e},t)}))})}),Object(w.jsx)(V,{owned:n,removeItem:function(e,t){var n={character_id:e.character_id,item_id:e.item_id},c="/sell/";!0===t&&(c="/consume/"),S.post(c,n).then((function(e){i(e.data.owned),u(e.data.consumed),C(!1)})).catch((function(e){_(["Delete failed! Server error",e.error]),C(!0)}))}})]}),Object(w.jsx)(v.a,{item:!0,xs:1}),Object(w.jsx)(v.a,{item:!0,sm:1,md:2}),Object(w.jsx)(v.a,{item:!0,sm:12,md:8,children:Object(w.jsx)(M,{consumed:s,removeItem:function(e,t){var n={character_id:e.character_id,item_id:e.item_id};S.post("/unconsume/",n).then((function(e){i(e.data.owned),u(e.data.consumed),C(!1)})).catch((function(e){_(["Delete failed! Server error",e.error]),C(!0)}))}})})]})})}function X(){var e=Object(a.useState)([]),t=Object(c.a)(e,2),n=t[0],i=t[1],o=Object(a.useState)(!1),r=Object(c.a)(o,2),s=r[0],u=r[1],d=Object(a.useState)([]),l=Object(c.a)(d,2),j=l[0],b=l[1];Object(a.useEffect)((function(){S.get("/items").then((function(e){i(e.data.data)})).catch((function(e){b(["Cannot load item data",e.error]),u(!0)}))}),[]);var f=[{title:"id",field:"id",hidden:!0},{title:"Item name",field:"name"},{title:"Type",field:"type"},{title:"Rarity",field:"rarity"},{title:"Cost",field:"cost",type:"numeric"}];return Object(w.jsx)(O.Consumer,{children:function(e){var t=e.loggedIn;return Object(w.jsx)("div",{className:"App",children:Object(w.jsxs)(v.a,{container:!0,spacing:1,children:[Object(w.jsx)(v.a,{item:!0,xs:2}),Object(w.jsxs)(v.a,{item:!0,xs:12,sm:8,children:[Object(w.jsx)("div",{children:s&&Object(w.jsx)(p.a,{severity:"error",children:j.map((function(e,t){return Object(w.jsx)("div",{children:e},t)}))})}),Object(w.jsx)(I.a,{title:"Defined Items",columns:f,data:n,editable:{onRowUpdate:t?function(e,t){return new Promise((function(c){!function(e,t,c){var a=[];void 0===e.name&&a.push("Please enter item name"),void 0===e.type&&a.push("Please enter item type"),void 0===e.rarity&&a.push("Please enter rarity"),(void 0===e.cost||e.cost<0)&&a.push("Please enter a proper cost"),a.length<1?S.patch("/items/"+e.id,e).then((function(c){var a=Object(x.a)(n);a[t.tableData.id]=e,i(Object(x.a)(a)),u(!1),b([])})).catch((function(e){b(["Update failed! Server error"]),u(!0)})):(b(a),u(!0))}(e,t),c()}))}:null,onRowAdd:t?function(e){return new Promise((function(t){!function(e,t){var c=[];void 0===e.name&&c.push("Please enter item name"),void 0===e.type&&c.push("Please enter item type"),void 0===e.rarity&&c.push("Please enter rarity"),(void 0===e.cost||e.cost<0)&&c.push("Please enter a proper cost"),c.length<1?S.post("/items",e).then((function(t){var c=Object(x.a)(n);e.id=t.data.data.id,c.push(e),i(c),b([]),u(!1)})).catch((function(e){b(["Cannot add data. Server error!"]),u(!0)})):(b(c),u(!0))}(e),t()}))}:null,onRowDelete:t?function(e){return new Promise((function(t){!function(e,t){S.delete("/items/"+e.id).then((function(t){var c=Object(x.a)(n),a=e.tableData.id;c.splice(a,1),i(Object(x.a)(c))})).catch((function(e){b(["Delete failed! Server error"]),u(!0)}))}(e),t()}))}:null},options:{actionsColumnIndex:-1}})]}),Object(w.jsx)(v.a,{item:!0,xs:3})]})})}})}var Z=Object(m.a)({palette:{type:"dark"}});function $(){var e=Object(a.useState)(0),t=Object(c.a)(e,2),n=t[0],i=t[1],o=function(e,t){i(t)};function r(e){var t=e.children,n=e.value,c=e.index,a=Object(u.a)(e,["children","value","index"]);return Object(w.jsx)("div",Object(s.a)(Object(s.a)({},a),{},{children:n===c&&Object(w.jsx)(d.a,{p:3,children:t})}))}return Object(w.jsxs)(l.a,{theme:Z,children:[Object(w.jsx)(j.a,{}),Object(w.jsx)(B,{}),Object(w.jsx)(b.a,{children:Object(w.jsx)(O.Consumer,{children:function(e){var t=e.loggedIn;return Object(w.jsxs)(f.a,{value:n,onChange:o,children:[Object(w.jsx)(h.a,{label:"Items"}),Object(w.jsx)(h.a,{label:"Inventory",disabled:!t}),Object(w.jsx)(h.a,{label:"Characters",disabled:!t})]})}})}),Object(w.jsx)(r,{value:n,index:0,children:Object(w.jsx)(X,{})}),Object(w.jsx)(r,{value:n,index:1,children:Object(w.jsx)(W,{})}),Object(w.jsx)(r,{value:n,index:2,children:Object(w.jsx)(y,{})})]})}Z.shadows=[];var ee=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,759)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),c(e),a(e),i(e),o(e)}))},te=function(){var e=Object(a.useState)(!1),t=Object(c.a)(e,2),n=t[0],o=t[1];return Object(w.jsx)(O.Provider,{value:{loggedIn:n,setLoggedIn:o},children:Object(w.jsx)(i.a.StrictMode,{children:Object(w.jsx)($,{})})})};r.a.render(Object(w.jsx)(te,{}),document.getElementById("root")),ee()}},[[720,1,2]]]);
//# sourceMappingURL=main.5166eac9.chunk.js.map