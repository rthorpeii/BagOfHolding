(this["webpackJsonpbag-of-holding"]=this["webpackJsonpbag-of-holding"]||[]).push([[0],{614:function(e,t){},616:function(e,t){},629:function(e,t){},631:function(e,t){},659:function(e,t){},661:function(e,t){},662:function(e,t){},667:function(e,t){},669:function(e,t){},688:function(e,t){},700:function(e,t){},703:function(e,t){},720:function(e,t,n){"use strict";n.r(t);var c=n(27),a=n(0),i=n.n(a),r=n(18),o=n.n(r),s=n(82),u=n(483),d=n(249),l=n(741),j=n(746),b=n(745),f=n(755),h=n(753),m=n(117),O=Object(a.createContext)(null),x=n(83),v=n(751),p=n(756),g=n(90),I=n.n(g),C=n(285),S=n.n(C).a.create({baseURL:"https://handy-haversack.herokuapp.com/api/",headers:{Authorization:"Bearer "+window.localStorage.getItem("authToken")}}),y=n(7);function w(){var e=Object(a.useState)([]),t=Object(c.a)(e,2),n=t[0],i=t[1],r=Object(a.useState)(!1),o=Object(c.a)(r,2),s=o[0],u=o[1],d=Object(a.useState)([]),l=Object(c.a)(d,2),j=l[0],b=l[1];Object(a.useEffect)((function(){S.get("/characters/").then((function(e){i(e.data.characters)})).catch((function(e){b(["Cannot load character data"]),u(!0)}))}),[]);return Object(y.jsx)("div",{className:"App",children:Object(y.jsxs)(v.a,{container:!0,spacing:1,children:[Object(y.jsx)(v.a,{item:!0,xs:2}),Object(y.jsxs)(v.a,{item:!0,xs:12,sm:8,children:[Object(y.jsx)("div",{children:s&&Object(y.jsx)(p.a,{severity:"error",children:j.map((function(e,t){return Object(y.jsx)("div",{children:e},t)}))})}),Object(y.jsx)(I.a,{title:"Your Characters",columns:[{title:"id",field:"id",hidden:!0},{title:"Character name",field:"name"}],data:n,editable:{onRowAdd:function(e){return new Promise((function(t){!function(e,t){if(void 0===e.name)return b(["Please enter character name"]),void u(!0);S.post("/characters/",e).then((function(e){i(n.concat(e.data.character)),u(!1)})).catch((function(e){b(["Cannot add data. Server error!"+e]),u(!0)}))}(e),t()}))},onRowDelete:function(e){return new Promise((function(t){!function(e,t){S.delete("/characters/"+e.id).then((function(t){var c=Object(x.a)(n),a=e.tableData.id;c.splice(a,1),i(Object(x.a)(c)),b([])})).catch((function(e){b(["Delete failed! Server error"]),u(!0)}))}(e),t()}))}},options:{actionsColumnIndex:-1,paging:!1,search:!1}})]}),Object(y.jsx)(v.a,{item:!0,xs:3})]})})}var k=n(742),P=n(372),_=n(215),T=n(359),D=n(482),L=n.n(D),N=n(360),A=n(295),E=n(610);var R=function(){var e=Object(a.useContext)(O).setLoggedIn;Object(a.useEffect)((function(){var t=!0,n=localStorage.getItem("authToken");if(null===n)return t&&e(!1),function(){return t=!1};var c=E.decode(n,{complete:!0}),a=new Date;return c.exp<a.getTime()&&t&&e(!0),function(){return t=!1}}),[e]),L()(S,(function(e){return S.get("/refresh").then((function(t){return localStorage.setItem("authToken",t.data.token),S.defaults.headers.Authorization="Bearer "+t.data.token,e.response.config.headers.Authorization="Bearer "+t.data.token,Promise.resolve()}))}));var t=function(e){console.log(e)},n=function(t){S.post("/login",{token:t.tokenObj.id_token}).then((function(t){window.localStorage.setItem("authToken",t.data.token),S.defaults.headers.Authorization="Bearer "+t.data.token,e(!0)})).catch((function(e){console.log("Authentication failed")}))},c=function(t){window.localStorage.removeItem("authToken"),e(!1)};return Object(y.jsx)(O.Consumer,{children:function(e){var a=e.loggedIn;return Object(y.jsx)("div",{children:a?Object(y.jsx)(A.GoogleLogout,{clientId:"1090301103642-op1uhu99i3naegpk86siaqqf4nddn0c1.apps.googleusercontent.com",buttonText:"Logout",onLogoutSuccess:c,onFailure:t,render:function(e){return Object(y.jsx)(N.a,{variant:"contained",onClick:e.onClick,disabled:e.disabled,children:"Logout"})},theme:"dark"}):Object(y.jsx)(A.GoogleLogin,{clientId:"1090301103642-op1uhu99i3naegpk86siaqqf4nddn0c1.apps.googleusercontent.com",buttonText:"Login",onSuccess:n,onFailure:t,cookiePolicy:"single_host_origin",isSignedIn:!0,theme:"dark"})})}})},B=Object(T.a)((function(e){return{root:{flexGrow:1},title:{flexGrow:1}}}));function z(){var e=B();return Object(y.jsx)("div",{className:e.root,children:Object(y.jsx)(k.a,{position:"static",children:Object(y.jsxs)(P.a,{children:[Object(y.jsx)(_.a,{variant:"h6",className:e.title,children:"Bag of Holding"}),Object(y.jsx)(R,{})]})})})}var F=n(743),q=n(744),G=n(374),U=n(757),J=Object(T.a)((function(e){return{mergecard:{flexDirection:"column",height:"100%"},costText:{paddingTop:"10px"}}}));function H(e){var t=J(),n=e.costTotal,i=e.onChange,r=Object(a.useState)([]),o=Object(c.a)(r,2),u=o[0],d=o[1],l=Object(a.useState)({}),j=Object(c.a)(l,2),b=j[0],f=j[1];return Object(a.useEffect)((function(){i(b)}),[b,i]),Object(a.useEffect)((function(){S.get("/characters/").then((function(e){d(e.data.characters),e.data.characters.length>0&&f(e.data.characters[0])})).catch((function(e){console.log("Cannot load character names")}))}),[]),Object(y.jsx)(F.a,{className:t.mergecard,children:Object(y.jsxs)(q.a,{children:[Object(y.jsx)(U.a,{id:"character-selection",value:b,options:u,getOptionLabel:function(e){return e.name},onChange:function(e,t){f(t)},renderInput:function(e){return Object(y.jsx)(G.a,Object(s.a)(Object(s.a)({},e),{},{label:"Character",variant:"outlined"}))}}),Object(y.jsxs)(_.a,{variant:"h6",className:t.costText,children:["Inventory Cost: ",n," gp"]})]})})}function M(e){var t=e.consumed,n=e.removeItem,c=e.columns;return Object(y.jsx)(I.a,{title:"Consumed Items",columns:c,data:t,actions:[{icon:"restore",tooltip:"Undo consume",onClick:function(e,t){return new Promise((function(e){!function(e,t){n(e,t)}(t,!0),e()}))}}],options:{actionsColumnIndex:-1,paging:!1,rowStyle:function(e,t){if(t%2)return{backgroundColor:"#333333"}},search:!1}})}var Q=Object(T.a)((function(e){return{root:{height:"100%"}}}));function Y(e){var t=Q(),n=Object(a.useState)([]),i=Object(c.a)(n,2),r=i[0],o=i[1],u=Object(a.useState)({}),d=Object(c.a)(u,2),l=d[0],j=d[1];return Object(a.useEffect)((function(){S.get("/names/").then((function(e){o(e.data.items)})).catch((function(e){console.log("Cannot load item names")}))}),[]),Object(y.jsx)(F.a,{className:t.root,children:Object(y.jsx)(q.a,{children:Object(y.jsxs)(v.a,{container:!0,spacing:2,children:[Object(y.jsx)(v.a,{item:!0,xs:12,sm:12,md:7,children:Object(y.jsx)(U.a,{id:"purchase-selection",options:r,getOptionLabel:function(e){return e.Name},onChange:function(e,t){j(t)},renderInput:function(e){return Object(y.jsx)(G.a,Object(s.a)(Object(s.a)({},e),{},{label:"Item to purchase",variant:"outlined"}))}})}),Object(y.jsx)(v.a,{item:!0,xs:12,sm:12,md:5,children:Object(y.jsx)(N.a,{variant:"contained",onClick:function(){e.buyItem(l)},children:"Purchase"})})]})})})}function K(e){var t=e.owned,n=e.removeItem,c=e.columns,a=function(e,t){n(e,t)};return Object(y.jsx)(I.a,{title:"Owned Items",columns:c,data:t,editable:{onRowDelete:function(e){return new Promise((function(t){a(e,!1),t()}))}},actions:[{icon:"emoji_food_beverage",tooltip:"Consume",onClick:function(e,t){return new Promise((function(e){a(t,!0),e()}))}}],options:{actionsColumnIndex:-1,paging:!1,rowStyle:function(e,t){if(t%2)return{backgroundColor:"#333333"}},search:!1}})}var V=n(729),W=n(20);function X(){var e=Object(a.useState)([]),t=Object(c.a)(e,2),n=t[0],i=t[1],r=Object(a.useState)([]),o=Object(c.a)(r,2),s=o[0],u=o[1],d=Object(a.useState)({}),l=Object(c.a)(d,2),j=l[0],b=l[1],f=Object(a.useState)(0),h=Object(c.a)(f,2),m=h[0],O=h[1],x=Object(a.useState)(!1),g=Object(c.a)(x,2),I=g[0],C=g[1],w=Object(a.useState)([]),k=Object(c.a)(w,2),P=k[0],_=k[1],T=Object(W.a)(),D=[{title:"id",field:"id",hidden:!0},{title:"user_id",field:"user_id",hidden:!0},{title:"item_id",field:"user_id",hidden:!0},{title:"Name",field:"Item.name"},{title:"Rarity",field:"Item.rarity",hidden:Object(V.a)(T.breakpoints.down("xs"))},{title:"Cost",field:"Item.cost",type:"numeric",cellStyle:{padding:1},headerStyle:{padding:1}},{title:"Qty",field:"count",type:"numeric"}],L=function(){return console.log("Character: ",j),0!==Object.keys(j).length||j.constructor!==Object||(_(["Please Select a Character"]),C(!0),!1)};return Object(a.useEffect)((function(){var e=!0;if(!e||L())return S.get("/inventory/"+j.id).then((function(t){e&&(i(t.data.owned),u(t.data.consumed),C(!1))})).catch((function(t){e&&(_(["Cannot load inventory data"]),C(!0))})),function(){return e=!1}}),[j]),Object(a.useEffect)((function(){var e=!0;return e&&(C(!1),_([])),function(){return e=!1}}),[]),Object(a.useEffect)((function(){var e=!0,t=[n.reduce((function(e,t){return e+(t.Item.cost*t.count||0)}),0)],c=[s.reduce((function(e,t){return e+(t.Item.cost*t.count||0)}),0)];return e&&O(Number(t)+Number(c)),function(){return e=!1}}),[n,s]),Object(y.jsx)("div",{className:"App",children:Object(y.jsxs)(v.a,{container:!0,spacing:1,children:[Object(y.jsx)(v.a,{item:!0,sm:12,md:2}),Object(y.jsx)(v.a,{item:!0,xs:12,sm:6,md:4,children:Object(y.jsx)(H,{onChange:b,costTotal:m})}),Object(y.jsx)(v.a,{item:!0,xs:12,sm:6,md:4,children:Object(y.jsx)(Y,{buyItem:function(e){if(0===Object.keys(e).length&&e.constructor===Object)return _(["Please Select an Item"]),void C(!0);if(L()){var t={character_id:j.id,item_id:e.ID};S.post("/buy/",t).then((function(e){i(e.data.owned),u(e.data.consumed),C(!1)})).catch((function(e){_(["Cannot purchase Item"]),C(!0)}))}}})}),Object(y.jsx)(v.a,{item:!0,sm:1}),Object(y.jsx)(v.a,{item:!0,sm:1,md:2}),Object(y.jsxs)(v.a,{item:!0,xs:12,md:8,children:[Object(y.jsx)("div",{children:I&&Object(y.jsx)(p.a,{severity:"error",children:P.map((function(e,t){return Object(y.jsx)("div",{children:e},t)}))})}),Object(y.jsx)(K,{owned:n,removeItem:function(e,t){var n={character_id:e.character_id,item_id:e.item_id},c="/sell/";!0===t&&(c="/consume/"),S.post(c,n).then((function(e){i(e.data.owned),u(e.data.consumed),C(!1)})).catch((function(e){_(["Delete failed! Server error",e.error]),C(!0)}))},columns:D})]}),Object(y.jsx)(v.a,{item:!0,xs:1}),Object(y.jsx)(v.a,{item:!0,sm:1,md:2}),Object(y.jsx)(v.a,{item:!0,xs:12,md:8,children:Object(y.jsx)(M,{consumed:s,removeItem:function(e,t){var n={character_id:e.character_id,item_id:e.item_id};S.post("/unconsume/",n).then((function(e){i(e.data.owned),u(e.data.consumed),C(!1)})).catch((function(e){_(["Delete failed! Server error",e.error]),C(!0)}))},columns:D})})]})})}function Z(){var e=Object(a.useState)([]),t=Object(c.a)(e,2),n=t[0],i=t[1],r=Object(a.useState)(!1),o=Object(c.a)(r,2),s=o[0],u=o[1],d=Object(a.useState)([]),l=Object(c.a)(d,2),j=l[0],b=l[1];Object(a.useEffect)((function(){S.get("/items").then((function(e){i(e.data.data)})).catch((function(e){b(["Cannot load item data",e.error]),u(!0)}))}),[]);var f=[{title:"id",field:"id",hidden:!0},{title:"Item name",field:"name"},{title:"Type",field:"type"},{title:"Rarity",field:"rarity"},{title:"Cost",field:"cost",type:"numeric"}];return Object(y.jsx)(O.Consumer,{children:function(e){var t=e.loggedIn;return Object(y.jsx)("div",{className:"App",children:Object(y.jsxs)(v.a,{container:!0,spacing:1,children:[Object(y.jsx)(v.a,{item:!0,xs:2}),Object(y.jsxs)(v.a,{item:!0,xs:12,sm:8,children:[Object(y.jsx)("div",{children:s&&Object(y.jsx)(p.a,{severity:"error",children:j.map((function(e,t){return Object(y.jsx)("div",{children:e},t)}))})}),Object(y.jsx)(I.a,{title:"Defined Items",columns:f,data:n,editable:{onRowUpdate:t?function(e,t){return new Promise((function(c){!function(e,t,c){var a=[];void 0===e.name&&a.push("Please enter item name"),void 0===e.type&&a.push("Please enter item type"),void 0===e.rarity&&a.push("Please enter rarity"),(void 0===e.cost||e.cost<0)&&a.push("Please enter a proper cost"),a.length<1?S.patch("/items/"+e.id,e).then((function(c){var a=Object(x.a)(n);a[t.tableData.id]=e,i(Object(x.a)(a)),u(!1),b([])})).catch((function(e){b(["Update failed! Server error"]),u(!0)})):(b(a),u(!0))}(e,t),c()}))}:null,onRowAdd:t?function(e){return new Promise((function(t){!function(e,t){var c=[];void 0===e.name&&c.push("Please enter item name"),void 0===e.type&&c.push("Please enter item type"),void 0===e.rarity&&c.push("Please enter rarity"),(void 0===e.cost||e.cost<0)&&c.push("Please enter a proper cost"),c.length<1?S.post("/items",e).then((function(t){var c=Object(x.a)(n);e.id=t.data.data.id,c.push(e),i(c),b([]),u(!1)})).catch((function(e){b(["Cannot add data. Server error!"]),u(!0)})):(b(c),u(!0))}(e),t()}))}:null,onRowDelete:t?function(e){return new Promise((function(t){!function(e,t){S.delete("/items/"+e.id).then((function(t){var c=Object(x.a)(n),a=e.tableData.id;c.splice(a,1),i(Object(x.a)(c))})).catch((function(e){b(["Delete failed! Server error"]),u(!0)}))}(e),t()}))}:null},options:{actionsColumnIndex:-1,pageSize:10,pageSizeOptions:[10,25,50]}})]}),Object(y.jsx)(v.a,{item:!0,xs:3})]})})}})}var $=Object(m.a)({palette:{type:"dark"}});function ee(){var e=Object(a.useState)(0),t=Object(c.a)(e,2),n=t[0],i=t[1],r=function(e,t){i(t)};function o(e){var t=e.children,n=e.value,c=e.index,a=Object(u.a)(e,["children","value","index"]);return Object(y.jsx)("div",Object(s.a)(Object(s.a)({},a),{},{children:n===c&&Object(y.jsx)(d.a,{p:3,children:t})}))}return Object(y.jsxs)(l.a,{theme:$,children:[Object(y.jsx)(j.a,{}),Object(y.jsx)(z,{}),Object(y.jsx)(b.a,{children:Object(y.jsx)(O.Consumer,{children:function(e){var t=e.loggedIn;return Object(y.jsxs)(f.a,{value:n,onChange:r,children:[Object(y.jsx)(h.a,{label:"Items"}),Object(y.jsx)(h.a,{label:"Inventory",disabled:!t}),Object(y.jsx)(h.a,{label:"Characters",disabled:!t})]})}})}),Object(y.jsx)(o,{value:n,index:0,children:Object(y.jsx)(Z,{})}),Object(y.jsx)(o,{value:n,index:1,children:Object(y.jsx)(X,{})}),Object(y.jsx)(o,{value:n,index:2,children:Object(y.jsx)(w,{})})]})}$.shadows=[];var te=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,759)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,i=t.getLCP,r=t.getTTFB;n(e),c(e),a(e),i(e),r(e)}))},ne=function(){var e=Object(a.useState)(!1),t=Object(c.a)(e,2),n=t[0],r=t[1];return Object(y.jsx)(O.Provider,{value:{loggedIn:n,setLoggedIn:r},children:Object(y.jsx)(i.a.StrictMode,{children:Object(y.jsx)(ee,{})})})};o.a.render(Object(y.jsx)(ne,{}),document.getElementById("root")),te()}},[[720,1,2]]]);
//# sourceMappingURL=main.5b797bf3.chunk.js.map