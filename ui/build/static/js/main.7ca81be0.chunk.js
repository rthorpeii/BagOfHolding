(this["webpackJsonpbag-of-holding"]=this["webpackJsonpbag-of-holding"]||[]).push([[0],{614:function(e,t){},616:function(e,t){},629:function(e,t){},631:function(e,t){},659:function(e,t){},661:function(e,t){},662:function(e,t){},667:function(e,t){},669:function(e,t){},688:function(e,t){},700:function(e,t){},703:function(e,t){},720:function(e,t,n){"use strict";n.r(t);var c=n(27),a=n(0),o=n.n(a),i=n(18),r=n.n(i),s=n(82),u=n(483),d=n(249),l=n(741),j=n(746),b=n(745),f=n(117),h=Object(a.createContext)(null),m=n(83),O=n(751),x=n(756),v=n(90),p=n.n(v),g=n(285),C=n.n(g).a.create({baseURL:"https://handy-haversack.herokuapp.com/api/",headers:{Authorization:"Bearer "+window.localStorage.getItem("authToken")}}),I=n(7);function y(){var e=Object(a.useState)([]),t=Object(c.a)(e,2),n=t[0],o=t[1],i=Object(a.useState)(!1),r=Object(c.a)(i,2),s=r[0],u=r[1],d=Object(a.useState)([]),l=Object(c.a)(d,2),j=l[0],b=l[1];Object(a.useEffect)((function(){C.get("/characters/").then((function(e){o(e.data.characters)})).catch((function(e){b(["Cannot load character data"]),u(!0)}))}),[]);return Object(I.jsx)("div",{className:"App",children:Object(I.jsxs)(O.a,{container:!0,spacing:1,children:[Object(I.jsx)(O.a,{item:!0,xs:2}),Object(I.jsxs)(O.a,{item:!0,xs:12,sm:8,children:[Object(I.jsx)("div",{children:s&&Object(I.jsx)(x.a,{severity:"error",children:j.map((function(e,t){return Object(I.jsx)("div",{children:e},t)}))})}),Object(I.jsx)(p.a,{title:"Your Characters",columns:[{title:"id",field:"id",hidden:!0},{title:"Character name",field:"name"}],data:n,editable:{onRowAdd:function(e){return new Promise((function(t){!function(e,t){if(void 0===e.name)return b(["Please enter character name"]),void u(!0);C.post("/characters/",e).then((function(e){o(n.concat(e.data.character)),u(!1)})).catch((function(e){b(["Cannot add data. Server error!"+e]),u(!0)}))}(e),t()}))},onRowDelete:function(e){return new Promise((function(t){!function(e,t){C.delete("/characters/"+e.id).then((function(t){var c=Object(m.a)(n),a=e.tableData.id;c.splice(a,1),o(Object(m.a)(c)),b([])})).catch((function(e){b(["Delete failed! Server error"]),u(!0)}))}(e),t()}))}},options:{actionsColumnIndex:-1,paging:!1,search:!1}})]}),Object(I.jsx)(O.a,{item:!0,xs:3})]})})}var S=n(742),w=n(372),k=n(215),P=n(359),D=n(482),_=n.n(D),T=n(360),L=n(295),N=n(610);var A=function(){var e=Object(a.useContext)(h).setLoggedIn;Object(a.useEffect)((function(){var t=!0,n=localStorage.getItem("authToken");if(null===n)return t&&e(!1),function(){return t=!1};var c=N.decode(n,{complete:!0}),a=new Date;return c.exp<a.getTime()&&t&&e(!0),function(){return t=!1}}),[e]),_()(C,(function(e){return C.get("/refresh").then((function(t){return localStorage.setItem("authToken",t.data.token),C.defaults.headers.Authorization="Bearer "+t.data.token,e.response.config.headers.Authorization="Bearer "+t.data.token,Promise.resolve()}))}));var t=function(e){console.log(e)},n=function(t){C.post("/login",{token:t.tokenObj.id_token}).then((function(t){window.localStorage.setItem("authToken",t.data.token),C.defaults.headers.Authorization="Bearer "+t.data.token,e(!0)})).catch((function(e){console.log("Authentication failed")}))},c=function(t){window.localStorage.removeItem("authToken"),e(!1)};return Object(I.jsx)(h.Consumer,{children:function(e){var a=e.loggedIn;return Object(I.jsx)("div",{children:a?Object(I.jsx)(L.GoogleLogout,{clientId:"1090301103642-op1uhu99i3naegpk86siaqqf4nddn0c1.apps.googleusercontent.com",buttonText:"Logout",onLogoutSuccess:c,onFailure:t,render:function(e){return Object(I.jsx)(T.a,{variant:"contained",onClick:e.onClick,disabled:e.disabled,children:"Logout"})},theme:"dark"}):Object(I.jsx)(L.GoogleLogin,{clientId:"1090301103642-op1uhu99i3naegpk86siaqqf4nddn0c1.apps.googleusercontent.com",buttonText:"Login",onSuccess:n,onFailure:t,cookiePolicy:"single_host_origin",isSignedIn:!0,theme:"dark"})})}})},B=Object(P.a)((function(e){return{root:{flexGrow:1},title:{flexGrow:1}}}));function E(){var e=B();return Object(I.jsx)("div",{className:e.root,children:Object(I.jsx)(S.a,{position:"static",children:Object(I.jsxs)(w.a,{children:[Object(I.jsx)(k.a,{variant:"h6",className:e.title,children:"Handy Haversack"}),Object(I.jsx)(A,{})]})})})}var R=n(458),z=n(743),F=n(744),q=n(374),G=n(757),U=Object(P.a)((function(e){return{mergecard:{flexDirection:"column",height:"100%"},costText:{paddingTop:"10px"}}}));function H(e){var t=U(),n=e.costTotal,o=e.onChange,i=Object(a.useState)([]),r=Object(c.a)(i,2),u=r[0],d=r[1],l=Object(a.useState)({}),j=Object(c.a)(l,2),b=j[0],f=j[1];return Object(a.useEffect)((function(){o(b)}),[b,o]),Object(a.useEffect)((function(){C.get("/characters/").then((function(e){d(e.data.characters),e.data.characters.length>0&&f(e.data.characters[0])})).catch((function(e){console.log("Cannot load character names")}))}),[]),Object(I.jsx)(z.a,{className:t.mergecard,children:Object(I.jsxs)(F.a,{children:[Object(I.jsx)(G.a,{id:"character-selection",value:b,options:u,getOptionLabel:function(e){return e.name},onChange:function(e,t){f(t)},renderInput:function(e){return Object(I.jsx)(q.a,Object(s.a)(Object(s.a)({},e),{},{label:"Character",variant:"outlined"}))}}),Object(I.jsxs)(k.a,{variant:"h6",className:t.costText,children:["Inventory Cost: ",n," gp"]})]})})}function J(e){var t=e.consumed,n=e.removeItem,c=e.columns;return Object(I.jsx)(p.a,{title:"Consumed Items",columns:c,data:t,actions:[{icon:"restore",tooltip:"Undo consume",onClick:function(e,t){return new Promise((function(e){!function(e,t){n(e,t)}(t,!0),e()}))}}],options:{actionsColumnIndex:-1,paging:!1,rowStyle:function(e,t){if(t%2)return{backgroundColor:"#333333"}},search:!1}})}var V=Object(P.a)((function(e){return{outerCard:{flexDirection:"column",height:"100%"},itemDropdown:{paddingBottom:"10px"}}}));function M(e){var t=V(),n=Object(a.useState)([]),o=Object(c.a)(n,2),i=o[0],r=o[1],u=Object(a.useState)({}),d=Object(c.a)(u,2),l=d[0],j=d[1];return Object(a.useEffect)((function(){C.get("/names/").then((function(e){r(e.data.items)})).catch((function(e){console.log("Cannot load item names")}))}),[]),Object(I.jsx)(z.a,{className:t.outerCard,children:Object(I.jsxs)(F.a,{children:[Object(I.jsx)(G.a,{className:t.itemDropdown,options:i,getOptionLabel:function(e){return e.Name},onChange:function(e,t){j(t)},renderInput:function(e){return Object(I.jsx)(q.a,Object(s.a)(Object(s.a)({},e),{},{label:"Item to buy",variant:"outlined"}))}}),Object(I.jsx)(T.a,{variant:"contained",onClick:function(){e.buyItem(l)},children:"Buy Item"})]})})}function Q(e){var t=e.owned,n=e.removeItem,c=e.columns,a=function(e,t){n(e,t)};return Object(I.jsx)(p.a,{title:"Owned Items",columns:c,data:t,editable:{onRowDelete:function(e){return new Promise((function(t){a(e,!1),t()}))}},actions:[{icon:"emoji_food_beverage",tooltip:"Consume",onClick:function(e,t){return new Promise((function(e){a(t,!0),e()}))}}],options:{actionsColumnIndex:-1,paging:!1,rowStyle:function(e,t){if(t%2)return{backgroundColor:"#333333"}},search:!1}})}var Y=n(729),K=n(20);function W(){var e=Object(a.useState)([]),t=Object(c.a)(e,2),n=t[0],o=t[1],i=Object(a.useState)([]),r=Object(c.a)(i,2),s=r[0],u=r[1],d=Object(a.useState)({}),l=Object(c.a)(d,2),j=l[0],b=l[1],f=Object(a.useState)(0),h=Object(c.a)(f,2),m=h[0],v=h[1],p=Object(a.useState)(!1),g=Object(c.a)(p,2),y=g[0],S=g[1],w=Object(a.useState)([]),k=Object(c.a)(w,2),P=k[0],D=k[1],_=function(){return console.log("Character: ",j),null!==j&&(j.constructor!==Object||0!==Object.keys(j).length)||(D(["Please select a character. If you have no characters, add one in the Characters tab"]),S(!0),!1)};Object(a.useEffect)((function(){var e=!0;if(!e||_())return C.get("/inventory/"+j.id).then((function(t){e&&(o(t.data.owned),u(t.data.consumed),v(t.data.cost),S(!1))})).catch((function(t){e&&(D(["Cannot load inventory data"]),S(!0))})),function(){return e=!1}}),[j]);var T=Object(K.a)(),L=[{title:"id",field:"id",hidden:!0},{title:"user_id",field:"user_id",hidden:!0},{title:"item_id",field:"user_id",hidden:!0},{title:"Name",field:"Item.name"},{title:"Rarity",field:"Item.rarity",hidden:Object(Y.a)(T.breakpoints.down("xs"))},{title:"Cost",field:"Item.cost",type:"numeric",cellStyle:{padding:1},headerStyle:{padding:1}},{title:"Qty",field:"count",type:"numeric"}];return Object(I.jsx)("div",{className:"App",children:Object(I.jsxs)(O.a,{container:!0,spacing:1,children:[Object(I.jsx)(R.a,{smDown:!0,children:Object(I.jsx)(O.a,{item:!0,md:2})}),Object(I.jsx)(O.a,{item:!0,xs:12,sm:6,md:4,children:Object(I.jsx)(H,{onChange:b,costTotal:m})}),Object(I.jsx)(O.a,{item:!0,xs:12,sm:6,md:4,children:Object(I.jsx)(M,{buyItem:function(e){if(0===Object.keys(e).length&&e.constructor===Object)return D(["Please Select an Item"]),void S(!0);if(_()){var t={character_id:j.id,item_id:e.ID};C.post("/buy/",t).then((function(e){o(e.data.owned),u(e.data.consumed),v(e.data.cost),S(!1)})).catch((function(e){D(["Cannot Buy Item"]),S(!0)}))}}})}),Object(I.jsxs)(R.a,{smDown:!0,children:[Object(I.jsx)(O.a,{item:!0,md:1}),Object(I.jsx)(O.a,{item:!0,md:2})]}),Object(I.jsxs)(O.a,{item:!0,xs:12,md:8,children:[Object(I.jsx)("div",{children:y&&Object(I.jsx)(x.a,{severity:"error",children:P.map((function(e,t){return Object(I.jsx)("div",{children:e},t)}))})}),Object(I.jsx)(Q,{owned:n,removeItem:function(e,t){var n={character_id:e.character_id,item_id:e.item_id};C.post(t?"/consume/":"/sell/",n).then((function(e){o(e.data.owned),u(e.data.consumed),v(e.data.cost),S(!1)})).catch((function(e){D(["Delete failed! Server error",e.error]),S(!0)}))},columns:L})]}),Object(I.jsxs)(R.a,{smDown:!0,children:[Object(I.jsx)(O.a,{item:!0,md:1}),Object(I.jsx)(O.a,{item:!0,md:2})]}),Object(I.jsx)(O.a,{item:!0,xs:12,md:8,children:Object(I.jsx)(J,{consumed:s,removeItem:function(e,t){var n={character_id:e.character_id,item_id:e.item_id};C.post("/unconsume/",n).then((function(e){o(e.data.owned),u(e.data.consumed),v(e.data.cost),S(!1)})).catch((function(e){D(["Delete failed! Server error",e.error]),S(!0)}))},columns:L})})]})})}function X(){var e=Object(a.useState)([]),t=Object(c.a)(e,2),n=t[0],o=t[1],i=Object(a.useState)(!1),r=Object(c.a)(i,2),s=r[0],u=r[1],d=Object(a.useState)([]),l=Object(c.a)(d,2),j=l[0],b=l[1];Object(a.useEffect)((function(){C.get("/items").then((function(e){o(e.data.data)})).catch((function(e){b(["Cannot load item data",e.error]),u(!0)}))}),[]);var f=[{title:"id",field:"id",hidden:!0},{title:"Item name",field:"name"},{title:"Type",field:"type"},{title:"Rarity",field:"rarity"},{title:"Cost",field:"cost",type:"numeric"}];return Object(I.jsx)(h.Consumer,{children:function(e){var t=e.loggedIn;return Object(I.jsx)("div",{className:"App",children:Object(I.jsxs)(O.a,{container:!0,spacing:1,children:[Object(I.jsx)(O.a,{item:!0,xs:2}),Object(I.jsxs)(O.a,{item:!0,xs:12,sm:8,children:[Object(I.jsx)("div",{children:s&&Object(I.jsx)(x.a,{severity:"error",children:j.map((function(e,t){return Object(I.jsx)("div",{children:e},t)}))})}),Object(I.jsx)(p.a,{title:"Defined Items",columns:f,data:n,editable:{onRowUpdate:t?function(e,t){return new Promise((function(c){!function(e,t,c){var a=[];void 0===e.name&&a.push("Please enter item name"),void 0===e.type&&a.push("Please enter item type"),void 0===e.rarity&&a.push("Please enter rarity"),(void 0===e.cost||e.cost<0)&&a.push("Please enter a proper cost"),a.length<1?C.patch("/items/"+e.id,e).then((function(c){var a=Object(m.a)(n);a[t.tableData.id]=e,o(Object(m.a)(a)),u(!1),b([])})).catch((function(e){b(["Update failed! Server error"]),u(!0)})):(b(a),u(!0))}(e,t),c()}))}:null,onRowAdd:t?function(e){return new Promise((function(t){!function(e,t){var c=[];void 0===e.name&&c.push("Please enter item name"),void 0===e.type&&c.push("Please enter item type"),void 0===e.rarity&&c.push("Please enter rarity"),(void 0===e.cost||e.cost<0)&&c.push("Please enter a proper cost"),c.length<1?C.post("/items",e).then((function(t){var c=Object(m.a)(n);e.id=t.data.data.id,c.push(e),o(c),b([]),u(!1)})).catch((function(e){b(["Cannot add data. Server error!"]),u(!0)})):(b(c),u(!0))}(e),t()}))}:null,onRowDelete:t?function(e){return new Promise((function(t){!function(e,t){C.delete("/items/"+e.id).then((function(t){var c=Object(m.a)(n),a=e.tableData.id;c.splice(a,1),o(Object(m.a)(c))})).catch((function(e){b(["Delete failed! Server error"]),u(!0)}))}(e),t()}))}:null},options:{actionsColumnIndex:-1,pageSize:10,pageSizeOptions:[10,25,50]}})]}),Object(I.jsx)(O.a,{item:!0,xs:3})]})})}})}var Z=n(755),$=n(753);function ee(e){var t=e.value,n=e.setValue,c=function(e,t){n(t)};return Object(I.jsx)(h.Consumer,{children:function(e){var n=e.loggedIn;return Object(I.jsxs)(Z.a,{value:t,onChange:c,children:[Object(I.jsx)($.a,{label:"Items"}),Object(I.jsx)($.a,{label:"Inventory",disabled:!n}),Object(I.jsx)($.a,{label:"Characters",disabled:!n})]})}})}var te=Object(f.a)({palette:{type:"dark"}});function ne(){var e=Object(a.useState)(0),t=Object(c.a)(e,2),n=t[0],o=t[1],i=Object(a.useContext)(h).loggedIn;function r(e){var t=e.children,n=e.value,c=e.index,a=Object(u.a)(e,["children","value","index"]);return Object(I.jsx)("div",Object(s.a)(Object(s.a)({},a),{},{children:n===c&&Object(I.jsx)(d.a,{p:3,children:t})}))}return Object(a.useEffect)((function(){i||o(0)}),[i]),Object(I.jsxs)(l.a,{theme:te,children:[Object(I.jsx)(j.a,{}),Object(I.jsx)(E,{}),Object(I.jsx)(b.a,{children:Object(I.jsx)(ee,{value:n,setValue:o})}),Object(I.jsx)(r,{value:n,index:0,children:Object(I.jsx)(X,{})}),Object(I.jsx)(r,{value:n,index:1,children:Object(I.jsx)(W,{})}),Object(I.jsx)(r,{value:n,index:2,children:Object(I.jsx)(y,{})})]})}te.shadows=[];var ce=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,759)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,o=t.getLCP,i=t.getTTFB;n(e),c(e),a(e),o(e),i(e)}))},ae=function(){var e=Object(a.useState)(!1),t=Object(c.a)(e,2),n=t[0],i=t[1];return Object(I.jsx)(h.Provider,{value:{loggedIn:n,setLoggedIn:i},children:Object(I.jsx)(o.a.StrictMode,{children:Object(I.jsx)(ne,{})})})};r.a.render(Object(I.jsx)(ae,{}),document.getElementById("root")),ce()}},[[720,1,2]]]);
//# sourceMappingURL=main.7ca81be0.chunk.js.map